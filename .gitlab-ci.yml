stages:
  - install
  - test
  - build
#  - deploy

cache:
  key: "${CI_COMMIT_REF_SLUG}"
  paths:
    - vendor/
    - composer.lock

install_dependencies:
  stage: install
  image: php:7.0-cli
  before_script:
    - apt-get update && apt-get install -y unzip php-zip git curl
    - cp /usr/local/etc/php/php.ini-development /usr/local/etc/php/php.ini
    - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
  script:
    - composer install --prefer-dist --no-progress --ignore-platform-reqs
    - php -v
  artifacts:
    paths:
      - vendor/

test:
  stage: test
  image: php:7.0-cli
  before_script:
    - apt-get update && apt-get install -y unzip php-zip unzip
    - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
    - cp /usr/local/etc/php/php.ini-development /usr/local/etc/php/php.ini
    - composer install --prefer-dist --no-progress --ignore-platform-reqs
    - php -v
  script:
    - ./vendor/bin/phpunit --testdox

build:
  stage: build
  image: php:7.0-cli
  script:
    - echo "Building project..."

#deploy:
#  stage: deploy
#  image: alpine:latest
#  only:
#    - main
#  before_script:
#    - apk add --no-cache openssh
#  script:
#    - scp -r ./* user@your_server:/path/to/deployment/
